---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# epitraxr

<!-- badges: start -->
[![ForeSITE Group](https://github.com/EpiForeSITE/software/raw/e82ed88f75e0fe5c0a1a3b38c2b94509f122019c/docs/assets/foresite-software-badge.svg)](https://github.com/EpiForeSITE)
[![Lifecycle: experimental](https://img.shields.io/badge/lifecycle-experimental-orange.svg)](https://lifecycle.r-lib.org/articles/stages.html#experimental)
[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://github.com/EpiForeSITE/epitraxr/blob/master/LICENSE.md)
[![R-CMD-check](https://github.com/EpiForeSITE/epitraxr/actions/workflows/r-check.yaml/badge.svg)](https://github.com/EpiForeSITE/epitraxr/actions/workflows/r-check.yaml)
[![pkgdown](https://github.com/EpiForeSITE/epitraxr/actions/workflows/pkgdown.yaml/badge.svg)](https://github.com/EpiForeSITE/epitraxr/actions/workflows/pkgdown.yaml)
[![codecov](https://codecov.io/gh/EpiForeSITE/epitraxr/graph/badge.svg?token=KC48SFPX39)](https://codecov.io/gh/EpiForeSITE/epitraxr)
<!-- badges: end -->

## Overview

EpiTrax is a central repository for epidemiological data developed by Utah State's Department of Health and Human Services (DHHS). It is now used by several other states. Through EpiTrax, public health officials have access to many different types of disease surveillance data, which they use to produce regular (e.g., weekly, monthly, annual) reports on their respective jurisdictions. This can be a tedious, time-intensive process, often involving multiple spreadsheets.

The `epitraxr` package makes it fast and easy to process EpiTrax data and generate reports. With `epitraxr` it is simple to setup a report pipeline, then you simply hit "run" and select your latest EpiTrax export---`epitraxr` will do the rest!

The package is targeted toward public health officials. Work to create this package was made possible by cooperative agreement CDC-RFA-FT-23-0069 from the CDC's Center for Forecasting and Outbreak Analytics.

## Installation

You can install the development version of `epitraxr` from [GitHub](https://github.com/EpiForeSITE/epitraxr) with:

``` r
# install.packages("devtools")
devtools::install_github("EpiForeSITE/epitraxr")
```

### Installing Package Dependencies

Many features of `epitraxr` will work with the standard installation. However, there are several optional features, such as PDF report generation and the R Shiny app, that require you to install additional dependencies. You can do that with the command:

``` r
# install.packages("devtools")
devtools::install_github("EpiForeSITE/epitraxr", dependencies = TRUE)
```

For PDF reports, you may need to install a LaTeX distribution as well. We recommend using [TinyTeX](https://yihui.org/tinytex/) as described in the [R Markdown Cookbook](https://bookdown.org/yihui/rmarkdown-cookbook/install-latex.html). First, install the `tinytex` package:

``` r
install.packages("tinytex")
```

Then, install TinyTeX (the LaTeX distribution) using the `tinytex` package:

``` r
tinytex::install_tinytex()
# to uninstall TinyTeX, run
# tinytex::uninstall_tinytex()
```

At this point, the package should run fully for you.

## Usage

`epitraxr` can be used in either "standard" mode or "piped" mode (recommended).

### Standard Mode

```{r usage-standard}
library(epitraxr)

data_file <- system.file(
  "sample_data/sample_epitrax_data.csv",
  package = "epitraxr"
)
epitrax_data <- read_epitrax_data(data_file)

report <- create_report_annual_counts(
  data = epitrax_data,
  disease_names = c("Chickenpox", "Measles", "Lyme disease")
)

report
```

### Piped Mode (recommended)

```{r usage-piped}
library(epitraxr)

config_file <- system.file(
  "sample_data/sample_config.yml",
  package = "epitraxr"
)

disease_list_file <- system.file(
  "sample_data/sample_disease_list.csv",
  package = "epitraxr"
)

epitrax <- get_epitrax(data_file) |>
  epitrax_set_config_from_file(config_file) |>
  epitrax_add_report_diseases(list(
    internal = disease_list_file,
    public = disease_list_file
  )) |>
  epitrax_ireport_annual_counts()

epitrax$internal_reports$annual_counts
```

Piped mode makes it super simple to add additional reports.

```{r usage-piped-expanded}
epitrax <- get_epitrax(data_file) |>
  epitrax_set_config_from_file(config_file) |>
  epitrax_add_report_diseases(list(
    internal = disease_list_file,
    public = disease_list_file
  )) |>
  epitrax_ireport_annual_counts() |>
  epitrax_ireport_monthly_avgs() |>
  epitrax_ireport_ytd_counts_for_month()

list(epitrax$internal_reports)
```

### Shiny App

The epitraxr package includes a Shiny app, which provides a user-friendly interface for running report generation operations with epitraxr.

To run the Shiny app, you'll need to install the optional dependencies, such as `shiny` and `DT`.

``` r
devtools::install_github("EpiForeSITE/epitraxr", dependencies = TRUE)
```

Then you can run the app with `run_app()`.

``` r
# library(epitraxr)
run_app()
```

### Scripts

We've developed a couple of handy scripts that are included in the [GitHub repo](https://github.com/EpiForeSITE/epitraxr) under the [`scripts/` folder](https://github.com/EpiForeSITE/epitraxr/tree/main/scripts):

- [`epitraxr-piped.R`](https://github.com/EpiForeSITE/epitraxr/blob/main/scripts/epitraxr-piped.R): Showcases report generation using epitraxr's Piped Mode **(recommended)**
- [`epitraxr-generator.R`](https://github.com/EpiForeSITE/epitraxr/blob/main/scripts/epitraxr-generator.R): Showcases report generation using the epitraxr's Standard Mode

These scripts provide you with a full report generation process that should run successfully if you have the package installed with all additional dependencies (see above). They provide identical output to the [original project](https://github.com/EpiForeSITE/epitrax-report-automation) (currently inactive).

## Getting Help

If you encounter a clear bug, please file an issue with a minimal reproducible example on  [GitHub](https://github.com/EpiForeSITE/epitraxr/issues).

## Code of Conduct

Please note that the epitraxr project is released with a [Contributor Code of Conduct](https://epiforesite.github.io/epitraxr/CODE_OF_CONDUCT.html). By contributing to this project, you agree to abide by its terms.
