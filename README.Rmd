---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# epitraxr

<!-- badges: start -->
[![ForeSITE Group](https://github.com/EpiForeSITE/software/raw/e82ed88f75e0fe5c0a1a3b38c2b94509f122019c/docs/assets/foresite-software-badge.svg)](https://github.com/EpiForeSITE)
[![Lifecycle: experimental](https://img.shields.io/badge/lifecycle-experimental-orange.svg)](https://lifecycle.r-lib.org/articles/stages.html#experimental)
[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://github.com/EpiForeSITE/epitraxr/blob/master/LICENSE.md)
[![R-CMD-check](https://github.com/EpiForeSITE/epitraxr/actions/workflows/r-check.yaml/badge.svg)](https://github.com/EpiForeSITE/epitraxr/actions/workflows/r-check.yaml)
[![pkgdown](https://github.com/EpiForeSITE/epitraxr/actions/workflows/pkgdown.yaml/badge.svg)](https://github.com/EpiForeSITE/epitraxr/actions/workflows/pkgdown.yaml)
[![codecov](https://codecov.io/gh/EpiForeSITE/epitraxr/graph/badge.svg?token=KC48SFPX39)](https://codecov.io/gh/EpiForeSITE/epitraxr)
<!-- badges: end -->

## Overview

EpiTrax is a central repository for epidemiological data developed by Utah State's Department of Health and Human Services (DHHS). It is now used by several other states. Through EpiTrax, public health officials have access to many different types of disease surveillance data, which they use to produce regular (e.g., weekly, monthly, annual) reports on their respective jurisdictions. This can be a tedious, time-intensive process, often involving multiple spreadsheets.

The `epitraxr` package makes it fast and easy to process EpiTrax data and generate reports. With `epitraxr` it is simple to setup a report pipeline, then you simply hit "run" and select your latest EpiTrax export---`epitraxr` will do the rest!

The package is targeted toward public health officials. Work to create this software tool was made possible by cooperative agreement CDC-RFA-FT-23-0069 from the CDC's Center for Forecasting and Outbreak Analytics.

## Installation

You can install the development version of epitraxr from [GitHub](https://github.com/EpiForeSITE/epitraxr) with:

``` r
# install.packages("devtools")
devtools::install_github("EpiForeSITE/epitraxr")
```

## Usage

`epitraxr` can be used in either "standard" mode or "piped" mode (recommended).

### Standard Mode

```{r usage-standard}
library(epitraxr)

data_file <- system.file(
  "sample_data/sample_epitrax_data.csv",
  package = "epitraxr"
)
epitrax_data <- read_epitrax_data(data_file)

diseases <- c("Chickenpox", "Measles", "Lyme disease")

report <- create_report_annual_counts(
  data = epitrax_data,
  disease_names = diseases
)

report
```

### Piped Mode (recommended)

```{r usage-piped}
library(epitraxr)

config_file <- system.file(
  "sample_data/sample_config.yml",
  package = "epitraxr"
)

disease_list_file <- system.file(
  "sample_data/sample_disease_list.csv",
  package = "epitraxr"
)

epitrax <- get_epitrax(data_file) |>
  epitrax_set_config_from_file(config_file) |>
  epitrax_add_report_diseases(list(
    internal = disease_list_file,
    public = disease_list_file
  )) |>
  epitrax_ireport_annual_counts()

epitrax$internal_reports$annual_counts
```

Piped mode makes it super simple to add additional reports.

```{r usage-piped-expanded}
epitrax <- get_epitrax(data_file) |>
  epitrax_set_config_from_file(config_file) |>
  epitrax_add_report_diseases(list(
    internal = disease_list_file,
    public = disease_list_file
  )) |>
  epitrax_ireport_annual_counts() |>
  epitrax_ireport_monthly_avgs() |>
  epitrax_ireport_ytd_counts_for_month()

list(epitrax$internal_reports)
```
